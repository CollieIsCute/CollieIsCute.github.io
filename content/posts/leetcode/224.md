---
title: "224. Basic Calculator"
subtitle: ""
date: 2022-11-22T16:42:51+08:00
draft: true
author: ""
authorLink: ""
authorEmail: ""
description: ""
keywords: ""
license: ""
comment: false
weight: 0
tags:
- leetcode
- iterator
- C++

hiddenFromHomePage: false
hiddenFromSearch: false
summary: ""
resources:
- name: featured-image
  src: featured-image.jpg
- name: featured-image-preview
  src: featured-image-preview.jpg
toc:
  enable: true
math:
  enable: true
lightgallery: false
seo:
  images: []
repost:
  enable: false
  url: ""
---

## [åŸå§‹é¡Œç›®](https://leetcode.com/problems/basic-calculator/)
çµ¦å®šå­—ä¸²åŒ…å« `{ '+', '-', ' ', '(', ')'}` ä»¥åŠæ•¸å­—ï¼Œæ±‚å‡ºç®—å¼ç­”æ¡ˆã€‚  

## å€¼å¾—ç´€éŒ„ä¹‹è™•
### è™•ç†å¤ªå¤šæ¢ä»¶åˆ†æ”¯
æˆ‘è¦ºå¾—é€™é¡Œæœ€éº»ç…©çš„å‘åœ¨æ–¼ç¬¦è™Ÿå¤ªå¤šç¨®äº†ã€‚å¦‚æœç”¨ `if` ä¾†å¯«çš„è©±ï¼Œæœƒæœ‰å¤ªå¤šæ¢ä»¶åˆ†æ”¯ï¼ˆ branch condition ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´å¾ˆæƒ³æŠŠæŸäº› branch åˆåœ¨ä¸€èµ·ã€‚æ¯”å¦‚èªªï¼š  
1. `+`, `-` å¾Œé¢è·Ÿè‘— `(`
1. `+`, `-` å¾Œé¢è·Ÿè‘—æ•¸å­—
2. `+`, `-` å¾Œé¢æ˜¯ ` `, è€Œå†ä¹‹å¾Œé‚„å¯ä»¥æ··åˆå‰å…©é …çµ„åˆå‡ºæ›´å¤šç¨®è®ŠåŒ–ã€‚  

é€™æ¨£ä¹˜èµ·ä¾†æƒ…æ³éå¸¸å¤šï¼Œä¹Ÿå¾ˆé›£ç¶­è­·ã€‚å¦‚æœå¯ä»¥å¿½ç•¥æ‰ `+`, `-`, åªåœ¨é‡åˆ°æ•¸å­—å’Œ `(` çš„æ™‚å€™ï¼Œå†å¾€å›æª¢æŸ¥ç¬¦è™Ÿï¼Œå°±å¯ä»¥æ¸›å°‘éœ€è¦åˆ—èˆ‰çš„æƒ…æ³æ•¸é‡äº†ã€‚
### è™•ç†ç©ºæ ¼ï¼š `erase` + `remove_if`
å¦‚æœå¯ä»¥ä½¿å¾—å­—ä¸²è£¡é¢å®Œå…¨æ²’æœ‰ç©ºæ ¼ï¼Œé‚£éœ€è¦è™•ç†çš„æƒ…æ³ä¹Ÿå¯ä»¥å†æ›´åŠ ç²¾ç°¡ã€‚ C++ è£¡é¢æœ‰ä¸€å¥— `erase` + `remove_if` çµ„åˆæŠ€å¯ä»¥ç”¨ï¼š
```c++
s.erase(remove_if(s.begin(), s.end(), [](unsigned char ch) { return std::isspace(ch); }), s.end());
```

#### `remove` ç³»åˆ— v.s. `erase`
é€™å…©å€‹æˆ‘ä»¥å‰éƒ½ä¸€ç›´æä¸æ¸…æ¥šå·®ç•°ï¼Œç›´åˆ°å¯«é€™é¡Œæ™‚èªçœŸå»ç ”ç©¶ä»–å€‘ä¹‹é–“çš„å·®åˆ¥ä¸¦ç´€éŒ„æ–¼æ­¤ã€‚
- `ForwardIt remove(ForwardIt first, ForwardIt last, const T& value)`: å®ƒåœ¨åšçš„äº‹æƒ…æ˜¯ç§»å‹•å…ƒç´ ï¼Œä¸¦ä¸åŒ…å«åˆªé™¤å…ƒç´ æœ¬èº«ã€‚å¦‚æœ [first, end) å€é–“å…§æœ‰ä»»ä½•å…ƒç´ çš„å€¼ == `value` å‰‡æŠŠå¾Œé¢çš„è³‡æ–™æŒ‡æ´¾çµ¦ç›®å‰é€™ä¸€æ ¼å…ƒç´ ï¼Œæœ€å¾Œå†å›å‚³ä¸€å€‹ iterator ç‰©ä»¶ç•¶ä½œå¾…æœƒè¦ `erase()` çš„èµ·å§‹é»ã€‚æˆ‘è¦ºå¾—ä»–çš„å¯¦ä½œä¹Ÿå¾ˆæœ‰è¶£ï¼Œæ™‚é–“è¤‡é›œåº¦æ¯”å¯«å€‹è¿´åœˆä¸æ–· `find` ä¸¦åˆªé™¤å¿«å¾ˆå¤šï¼ˆ $O(n^2)$ v.s. $O(n)$ ï¼‰ï¼Œæˆ‘å¾ [cppreference è¤‡è£½éä¾†çš„]()ï¼Œæœ‰èˆˆè¶£çš„è©±æ¨è–¦è®€çœ‹çœ‹ã€‚
```c++
template< class ForwardIt, class T >
ForwardIt remove(ForwardIt first, ForwardIt last, const T& value)
{
    first = std::find(first, last, value);
    if (first != last)
        for(ForwardIt i = first; ++i != last; )
            if (!(*i == value))
                *first++ = std::move(*i);
    return first;
}
```
- è‡³æ–¼ `erase()` å‰‡æ˜¯å¯ä»¥å‚³å…¥é ­å°¾å…©å€‹ iterator åƒæ•¸ï¼Œåˆªé™¤è©²å€é–“ä¸¦ä¸”æŠŠé ­å°¾æ¥ä¸Šã€‚
- `remove_if()` è·Ÿ `remove()` æœ‰é»åƒï¼Œåªæ˜¯ç¬¬ä¸‰å€‹åƒæ•¸æ˜¯æ”¾ä¸€å€‹å›å‚³å€¼å¯è¢«è½‰æˆ `bool` çš„å‡½æ•¸ã€‚å®ƒæœƒå»å‘¼å«é‚£å€‹å‡½æ•¸ï¼Œä¸¦å¾å›å‚³å€¼åˆ¤æ–·è¦ä¸è¦ remove æ‰å…ƒç´ å…§çš„è³‡æ–™ã€‚

### stack è™•ç†è®Šè™Ÿ
ç›´è¦ºä¸Šæ¡ç”¨ stack ä¾†åˆ¤æ–·æ‹¬è™Ÿå…§å€åŸŸè¦ä¸è¦è®Šè™Ÿï¼Œé€²å…¥æ‹¬è™Ÿå°± push ä¸€å€‹æ–°çš„ç¬¦è™Ÿï¼Œå‡ºæ‹¬è™Ÿå‰‡ pop æœ€ä¸Šé¢çš„æ‹¬è™Ÿï¼Œå³å¯å®Œæˆåˆ¤æ–·ã€‚ï¼ˆå¦‚æœæœ‰ `*`, `/` æœƒæ¯”è¼ƒéº»ç…©ï¼Œè¦å¤šè™•ç†å››å‰‡é‹ç®—å„ªå…ˆåº¦çš„å•é¡Œï¼Œé‚„å¥½é€™é¡Œä¸ç”¨ğŸ˜…ï¼‰

### iterator å•é¡Œ
ä¼¼ä¹ä¸èƒ½æŠŠä»–ç†è§£ç‚ºæŒ‰ç…§å¤§å°æ’åˆ—çš„æŒ‡æ¨™ï¼Œç´€éŒ„æˆ‘é€™é™£å­æœ‰é‡åˆ°ä¸€äº›å‘ï¼š
1. æ²’æœ‰ `<=` operator, å¦‚æœç”¨ä»¥ä¸‹çš„å¯«æ³•æœƒæœ‰å•é¡Œã€‚è¦å¯«æˆ `!=` æ‰æ­£çµ±ã€‚
```c++
for(auto it = obj.begin(); it <= obj.end(); obj++){
  // do something
}
```
2. iterator æ²’æœ‰ç›´æ¥åŠ ä¸ŠæŸå€‹å¸¸æ•¸çš„é‹ç®—ï¼Œä½†æ˜¯æŒ‡æ¨™æœ‰é€™ç¨® Syntactic sugar å¯ä»¥è‡ªå‹•æ ¹æ“šå‹åˆ¥æ±ºå®šè¦å¾€å‰å¤šå°‘å€‹ bytes.
```c++
auto it = obj.begin();
// auto it = it + 3; // æ²’æœ‰é€™ç¨®é‹ç®—
std::advance(it, 3);
```

å¦‚æœä¹‹å¾Œèƒ½å¤ æ›´æ·±å…¥äº†è§£ iterator çš„åº•å±¤å¯¦ä½œï¼Œå†ä¾†å¯«ä¸€ç¯‡ç´€éŒ„æˆ‘å°æ–¼ iterator çš„äº†è§£å¥½äº†ğŸ˜†

## Solution

```c++
// after parsing, put `it` represent the last digit of num
int parse_num(int& num_head, const string& s){
	int cnt = 0, sign = (num_head > 0 && s[num_head - 1] == '-') ? -1 : 1;
	for(; isdigit(s[num_head + cnt]); cnt++)
		;
	int n = stoi(s.substr(num_head, cnt));
	num_head += (cnt - 1);
	return n * sign;
}

class Solution {
public:
	int calculate(string s) {
		s.erase(remove_if(s.begin(), s.end(), [](unsigned char ch) { return std::isspace(ch); }),
				s.end());
		stack<int> sign_stack{};
		int ret = 0, cur_sign = 1;
		for(auto it = 0; it < s.size(); it++)
			if(isdigit(s[it]))
				ret += parse_num(it, s) * cur_sign;
			else if(s[it] == '('){
				if(it>0 && s[it-1] == '-')
					sign_stack.push(-1);
				else
					sign_stack.push(1);
				cur_sign *= sign_stack.top();
			}
			else if(s[it] == ')'){
				cur_sign /= sign_stack.top();
				sign_stack.pop();
			}
		return ret;
	}
};
```